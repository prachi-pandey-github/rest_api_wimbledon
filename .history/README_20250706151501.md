# 🌟 Wimbledon Finals API

A lightweight Flask-based REST API to fetch historical data on Wimbledon Men's Singles Finals from 2014 to 2024. Features Redis caching, rate limiting, error handling, CORS, and comprehensive logging.

---

## 📦 Features

* Retrieve detailed information about finals for a specific year.
* List all available years.
* **Redis caching** for improved performance.
* Rate-limited to prevent abuse (Redis-backed).
* Well-documented API endpoints.
* Health check with Redis status monitoring.
* Cache management endpoints.
* Configurable security headers and CORS.
* **Production-ready** with Render deployment support.
* Graceful fallback when Redis is unavailable.

---

## 🚀 Installation

### Local Development

1. Clone the repository:

```bash
git clone https://github.com/your-username/wimbledon-api.git
cd wimbledon-api
```

2. Create a virtual environment:

```bash
python -m venv venv
source venv/bin/activate  # or venv\Scripts\activate on Windows
```

3. Install dependencies:

```bash
pip install -r requirements.txt
```

4. Set up environment variables:

```bash
cp .env.example .env
# Edit .env with your configuration
```

5. Install and start Redis (optional):

```bash
# Windows (using Chocolatey)
choco install redis-64

# macOS (using Homebrew)
brew install redis
brew services start redis

# Linux (Ubuntu)
sudo apt-get install redis-server
sudo systemctl start redis
```

### Production Deployment

See [DEPLOYMENT.md](DEPLOYMENT.md) for detailed Render deployment instructions.

---

## ⚙️ Usage

### Local Development

Start the Flask server:

```bash
python main.py
```

The server will be available at `http://localhost:5000`

---

## 🔌 API Endpoints

### 🔍 Health Check

**GET** `/health`

Returns the health status of the API.

---

### 📜 API Documentation

**GET** `/api/docs`

Returns metadata and documentation about available endpoints.

---

### 🗓️ Get Finals for a Specific Year (Simple)

**GET** `/wimbledon?year=YYYY`

Query Parameters:

* `year` (required): Year from 2014 to 2024.

Example:

```bash
curl "http://localhost:5000/wimbledon?year=2021"
```

Response:
```json
{
  "year": 2021,
  "champion": "Novak Djokovic",
  "runner_up": "Matteo Berrettini",
  "score": "6-7(4-7), 6-4, 6-4, 6-3",
  "sets": 4,
  "tiebreak": true
}
```

---

### 🗓️ Get Finals for a Specific Year (Detailed)

**GET** `/api/wimbledon?year=YYYY`

Query Parameters:

* `year` (required): Year from 2014 to 2024.

Example:

```bash
curl "http://localhost:5000/api/wimbledon?year=2021"
```

Response includes additional metadata:
```json
{
  "year": 2021,
  "champion": "Novak Djokovic",
  "runner_up": "Matteo Berrettini",
  "score": "6-7(4-7), 6-4, 6-4, 6-3",
  "sets": 4,
  "tiebreak": true,
  "metadata": {
    "retrieved_at": "2025-07-06T07:28:22.556136Z",
    "data_source": "Wimbledon Championships Records",
    "api_version": "1.0.0"
  }
}
```

---

### 📆 List All Available Years

**GET** `/api/wimbledon/years`

Returns a sorted list of years for which data is available.

---

## 📊 Data Management

The Wimbledon data is stored in `wimbledon_data.json` for easy maintenance. To add new years or update results:

1. Edit `wimbledon_data.json`
2. Restart the server
3. No code changes required!

Example data structure:
```json
{
  "2024": {
    "champion": "Carlos Alcaraz",
    "runner_up": "Novak Djokovic",
    "score": "6-2, 6-2, 7-6(7-4)",
    "sets": 3,
    "tiebreak": true
  }
}
```

---

## 📈 Rate Limiting

* Global: `200/day`, `50/hour`
* `/wimbledon`: `30/minute`
* `/api/wimbledon`: `30/minute`
* `/api/wimbledon/years`: `10/minute`
* `/api/cache/clear`: `5/minute`
* `/api/cache/stats`: `10/minute`

Rate limiting uses Redis when available, falls back to memory-based limiting.

---

## 💾 Redis Caching

The API includes Redis-based caching for improved performance:

### Cache Configuration
* **Wimbledon data**: 1 hour TTL
* **Available years**: 2 hours TTL  
* **Health check**: 1 minute TTL

### Cache Management Endpoints
* `GET /api/cache/stats` - View cache statistics
* `POST /api/cache/clear` - Clear all cached data

### Environment Variables
| Variable | Description | Example |
|----------|-------------|---------|
| `REDIS_URL` | Full Redis connection string | `redis://username:password@host:port` |
| `REDIS_HOST` | Redis host | `localhost` |
| `REDIS_PORT` | Redis port | `6379` |
| `REDIS_PASSWORD` | Redis password | `your-password` |

---

## 🔐 Security & Headers

* CORS configured for production domains
* Security headers included in every response
* Rate limiting with Redis backend
* Environment-based secret key management

---

## 📄 Environment Variables

| Variable     | Default          | Description                         |
| ------------ |---------------- | ----------------------------------- |
| `PORT`       | `5000`           | Port to run the server on           |
| `FLASK_ENV`  | `production`     | Set to `development` for debug mode |
| `SECRET_KEY` | Auto-generated   | Flask app secret key                |
| `REDIS_URL`  | None             | Redis connection string             |
| `REDIS_HOST` | `localhost`      | Redis host for local development    |
| `REDIS_PORT` | `6379`           | Redis port                          |

---

## 🧪 Testing

Test the API endpoints:

```bash
# Test simple endpoint
curl "http://localhost:5000/wimbledon?year=2021"

# Test detailed endpoint with caching
curl "http://localhost:5000/api/wimbledon?year=2021"

# Test cache statistics
curl "http://localhost:5000/api/cache/stats"

# Test error handling
curl "http://localhost:5000/wimbledon?year=2030"
```

---

## 🚀 Production Deployment

### Quick Deploy to Render

1. **Push to GitHub**:
   ```bash
   git init
   git add .
   git commit -m "Initial commit"
   git push origin main
   ```

2. **Deploy on Render**:
   - Go to [render.com](https://render.com)
   - Connect your GitHub repo
   - Use the included `render.yaml` for automatic setup
   - Redis and web service will be created automatically

3. **Manual Setup** (if not using render.yaml):
   - Create Redis service (Starter plan - free)
   - Create Web service with:
     - Build: `pip install -r requirements.txt`
     - Start: `gunicorn --bind 0.0.0.0:$PORT main:app`
     - Environment: Set `REDIS_URL` from Redis service

### Local Production Testing

```bash
# Install production dependencies
pip install -r requirements.txt

# Set environment variables
export SECRET_KEY="your-secure-secret-key"
export FLASK_ENV="production"
export REDIS_URL="redis://localhost:6379"

# Run with Gunicorn
gunicorn -w 4 -b 0.0.0.0:5000 main:app
```

For detailed deployment instructions, see [DEPLOYMENT.md](DEPLOYMENT.md).

---

